<!DOCTYPE html>
<html lang="ja">
	<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="manifest" href="manifest.json">

	<script>
		if ('serviceWorker' in navigator) {
		window.addEventListener('load', () => {
		navigator.serviceWorker.register('sw.js').then(registration => {
		console.log('ServiceWorker registration successful with scope: ', registration.scope);
		}, err => {
		console.log('ServiceWorker registration failed: ', err);
		}).catch(err => {
		console.log(err)
			});
		});
}
    </script>
  <title>IPTV ãƒãƒ£ãƒ³ãƒãƒ«å†ç”Ÿ</title>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #333;
      --card-color: #fff;
      --border-color: #ddd;
      --hover-bg: #eef;
    }

    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #eee;
      --card-color: #2c2c2c;
      --border-color: #444;
      --hover-bg: #333;
    }

    body {
      font-family: sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      padding: 20px;
      margin: 0;
      transition: background-color 0.3s, color 0.3s;
    }

    h1 {
      text-align: center;
    }

    #toggle-darkmode {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      font-size: 16px;
      background: var(--card-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
    }

    video {
      display: block;
      margin: 20px auto;
      width: 90%;
      max-width: 640px;
      border-radius: 8px;
    }
				
				    #video-controls {
      text-align: center;
      margin-bottom: 20px;
    }
    .control-btn {
      padding: 8px 14px;
      margin: 0 5px;
      font-size: 14px;
      background: var(--card-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
    

    #channel-list {
      max-height: 400px;
      overflow-y: auto;
      padding: 0;
      margin: 20px auto;
      max-width: 600px;
      list-style: none;
    }

    #channel-list li {
      background-color: var(--card-color);
      border: 1px solid var(--border-color);
      padding: 16px;
      margin-bottom: 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    #channel-list li:hover {
      background-color: var(--hover-bg);
    }
  </style>
</head>
<!-- æœ€åˆã‹ã‚‰ class="dark" ã‚’ä»˜ã‘ã‚‹ -->
<body class="dark">
  <h1>IPTV ãƒãƒ£ãƒ³ãƒãƒ«å†ç”Ÿ</h1>
  <button id="toggle-darkmode">â˜€ï¸ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿</button>

  <!-- å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
<div style="max-width:800px; margin:auto;">
    <video id="player" controls autoplay style="width:100%; height:auto; background:black;">
        <source src="" type="application/x-mpegURL">
        ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ video ã‚¿ã‚°ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
    </video>
    <div style="margin-top:10px; text-align:center;">
        <button id="fullscreenBtn">å…¨ç”»é¢</button>
        <button id="pipBtn">PIP</button>
    </div>
</div>
		  <!-- å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
  <video id="player" controls autoplay>
    <source id="videoSource" src="" type="application/x-mpegURL">
    ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ video ã‚¿ã‚°ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
  </video>

  <!-- å…¨ç”»é¢ãƒ»PiPãƒœã‚¿ãƒ³ -->
  <div id="video-controls">
    <button class="control-btn" id="fullscreen-btn">â›¶ å…¨ç”»é¢</button>
    <button class="control-btn" id="pip-btn">ğŸ“º PiP</button>
  </div>

  <!-- ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§ -->
  <ul id="channel-list">
    <li>ãƒãƒ£ãƒ³ãƒãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</li>
  </ul>

  <script>
    // ãƒãƒ£ãƒ³ãƒãƒ«èª­ã¿è¾¼ã¿
    async function loadChannels() {
      const url = "https://raw.githubusercontent.com/luongz/iptv-jp/main/jp_clean.m3u";
      try {
        const res = await fetch(url);
        const text = await res.text();
        const lines = text.split("\n");

        const channels = [];
        for (let i = 0; i < lines.length; i++) {
          if (lines[i].startsWith("#EXTINF")) {
            const name = lines[i].split(",").pop().trim();
            const streamUrl = lines[i + 1]?.trim();
            if (streamUrl && streamUrl.startsWith("http")) {
              channels.push({ name, url: streamUrl });
            }
          }
        }

        const usefulChannels = channels.slice(4);
        const list = document.getElementById("channel-list");
        list.innerHTML = "";

        usefulChannels.forEach(channel => {
          const li = document.createElement("li");
          li.textContent = channel.name;
          li.onclick = () => {
            const source = document.getElementById("videoSource");
            const player = document.getElementById("player");
            source.src = channel.url;
            player.load();
            player.play();
          };
          list.appendChild(li);
        });

      } catch (e) {
        console.error("èª­ã¿è¾¼ã¿å¤±æ•—", e);
        document.getElementById("channel-list").innerHTML =
          "<li>ãƒãƒ£ãƒ³ãƒãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</li>";
      }
    }

    loadChannels();

    // ğŸŒ— ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
    const toggleButton = document.getElementById("toggle-darkmode");
    toggleButton.onclick = () => {
      const body = document.body;
      body.classList.toggle("dark");

      toggleButton.textContent = body.classList.contains("dark")
        ? "â˜€ï¸ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿"
        : "ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿";
    };
  </script>
      
    // å…¨ç”»é¢è¡¨ç¤º
    document.getElementById("fullscreen-btn").onclick = () => {
      const video = document.getElementById("player");
      if (video.requestFullscreen) {
        video.requestFullscreen();
      } else if (video.webkitRequestFullscreen) {
        video.webkitRequestFullscreen();
      }
    };

    // PiPãƒ¢ãƒ¼ãƒ‰
    document.getElementById("pip-btn").onclick = async () => {
      const video = document.getElementById("player");
      if (document.pictureInPictureElement) {
        await document.exitPictureInPicture();
      } else {
        try {
          await video.requestPictureInPicture();
        } catch (err) {
          alert("PiPãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã‹ã€å‹•ç”»å†ç”Ÿä¸­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
        }
      }
    };



</body>
</html>
