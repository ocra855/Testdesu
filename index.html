<!DOCTYPE html>
<html lang="ja">
	<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="manifest" href="manifest.json">

	<script>
		if ('serviceWorker' in navigator) {
		window.addEventListener('load', () => {
		navigator.serviceWorker.register('sw.js').then(registration => {
		console.log('ServiceWorker registration successful with scope: ', registration.scope);
		}, err => {
		console.log('ServiceWorker registration failed: ', err);
		}).catch(err => {
		console.log(err)
			});
		});
}
    </script>
  <title>IPTV チャンネル再生</title>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #333;
      --card-color: #fff;
      --border-color: #ddd;
      --hover-bg: #eef;
    }

    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #eee;
      --card-color: #2c2c2c;
      --border-color: #444;
      --hover-bg: #333;
    }

    body {
      font-family: sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      padding: 20px;
      margin: 0;
      transition: background-color 0.3s, color 0.3s;
    }

    h1 {
      text-align: center;
    }

    #toggle-darkmode {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      font-size: 16px;
      background: var(--card-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
    }

    video {
      display: block;
      margin: 20px auto;
      width: 90%;
      max-width: 640px;
      border-radius: 8px;
    }

    #channel-list {
      max-height: 400px;
      overflow-y: auto;
      padding: 0;
      margin: 20px auto;
      max-width: 600px;
      list-style: none;
    }

    #channel-list li {
      background-color: var(--card-color);
      border: 1px solid var(--border-color);
      padding: 16px;
      margin-bottom: 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    #channel-list li:hover {
      background-color: var(--hover-bg);
    }
  </style>
</head>
<!-- 最初から class="dark" を付ける -->
<body class="dark">
  <h1>IPTV チャンネル再生</h1>
  <button id="toggle-darkmode">☀️ ライトモードに切替</button>

  <!-- 動画プレイヤー -->
  <video id="player" controls autoplay>
    <source id="videoSource" src="" type="application/x-mpegURL">
    お使いのブラウザは video タグに対応していません。
  </video>

  <!-- チャンネル一覧 -->
  <ul id="channel-list">
    <li>チャンネルを読み込み中...</li>
  </ul>

  <script>
    // チャンネル読み込み
    async function loadChannels() {
      const url = "https://raw.githubusercontent.com/luongz/iptv-jp/main/jp_clean.m3u";
      try {
        const res = await fetch(url);
        const text = await res.text();
        const lines = text.split("\n");

        const channels = [];
        for (let i = 0; i < lines.length; i++) {
          if (lines[i].startsWith("#EXTINF")) {
            const name = lines[i].split(",").pop().trim();
            const streamUrl = lines[i + 1]?.trim();
            if (streamUrl && streamUrl.startsWith("http")) {
              channels.push({ name, url: streamUrl });
            }
          }
        }

        const usefulChannels = channels.slice(4);
        const list = document.getElementById("channel-list");
        list.innerHTML = "";

        usefulChannels.forEach(channel => {
          const li = document.createElement("li");
          li.textContent = channel.name;
          li.onclick = () => {
            const source = document.getElementById("videoSource");
            const player = document.getElementById("player");
            source.src = channel.url;
            player.load();
            player.play();
          };
          list.appendChild(li);
        });

      } catch (e) {
        console.error("読み込み失敗", e);
        document.getElementById("channel-list").innerHTML =
          "<li>チャンネルの読み込みに失敗しました。</li>";
      }
    }

    loadChannels();

    // 🌗 ダークモード切替
    const toggleButton = document.getElementById("toggle-darkmode");
    toggleButton.onclick = () => {
      const body = document.body;
      body.classList.toggle("dark");

      toggleButton.textContent = body.classList.contains("dark")
        ? "☀️ ライトモードに切替"
        : "🌙 ダークモードに切替";
    };
  </script>
      



</body>
</html>
